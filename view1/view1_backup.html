<div class="container">
    <div class="layer1" style="z-index: 1">
        <svg
                xmlns="http://www.w3.org/2000/svg"
                id="svg4136"
                version="1.1"
                width="2000"
                height="1342"
                viewBox="0 0 2000 1342">
            <image
                    src="Milk_production.gif"
                    xlink:href="resource/img/Milk_production.gif"
                    y="0"
                    x="0"
                    id="image4144"
                    style="image-rendering:optimizeQuality"
                    preserveAspectRatio="none"
                    height="1342"
                    width="2000"></image>
        </svg>
    </div>
    <div class="layer2" style="z-index: 2; position: absolute; left:0; top:0">
        <svg
                xmlns="http://www.w3.org/2000/svg"
                id="svg4136"
                version="1.1"
                width="2000"
                height="1342"
                viewBox="0 0 2000 1342"
                >
            <rect id="svgbgrect" x='0' y='0' width="2000" height="1342" fill="grey" opacity="0.3"></rect>
            <!--<rect id="symbol" x="1380" y="200" height="120" width="140" fill="blue" opacity="0.1"></rect>-->
            <!--<foreignObject id="symbol1" x="450" y="300" height="50" width="200">-->

            <!--</foreignObject>-->
        </svg>
    </div>
    <script>
        //    var gauge1 = new d3.custom.gauge(d3.select('#symbol1'));
        //    gauge1.watch(PMQDemo.generator);
        //    PMQDemo.generator.start();

        function generateGauges(id, count) {

        }

//        var qrcode = new QRCode('qrcode');

        d3.csv('resource/demo.csv', function(err, data) {
            if(err!=null){
                console.log(err);
            }else{
                var layer2 = d3.selectAll('.layer2 svg');

                var highlights = layer2.selectAll('rect').data(data).enter().append('rect')
//                    .attr('fill', 'green')
//                    .attr('opacity','0.1')
                        .attr('x', function(d) {
                            return d.x;
                        })
                        .attr('y', function(d) {
                            return d.y;
                        })
                        .attr('width', function(d) {
                            return d.width;
                        })
                        .attr('height', function(d) {
                            return d.height;
                        })
                        .attr('id', function(d) {
                            var id = d.name +'-highlight';
//                        $(this).click(function() {
//                            alert(id)
//                        })
                            return id;

                        })
                        .attr('class', 'highlight');



//            highlights.append('div').attr('id', function(d) {
//                return d.name+'-qrcode'
//            })
//                    .attr('class', 'modal hide')
//                    .attr('role', 'dialog');

//                highlights.on('click',function(d) {
//                    $('#link')[0].click();
//                    qrcode.clear();
//                    qrcode.makeCode('hello, world!');
//                })

                layer2.selectAll('g').data(data).enter().append('g')

                        .attr('style','fill:blue, opacity:0.1, z-order:3')
                        .attr('transform', function(d) {
                            return 'translate('+ d.x+','+ d.y+')'
                        })

                        .attr('id', function(d) {
                            return d.name;
                        })
//                    .attr('class', function(d) {
////                        console.log(this)
//                        return 'equipment'
//                    })




//            var equipments = layer2.selectAll('foreignObject').data(data).enter().append('foreignObject');
//            equipments.attr('id', function(d) {
//                    return d.name;
//                }).attr('x', function(d) {
//                    return d.x;ÃŽ
//                }).attr('y', function(d) {
//                    return d.y;
//                }).attr('width', function(d) {
//                    return d.width;
//                }).attr('height', function(d) {
//                    return d.height;
//                }).attr('class', 'equipment');
                data.forEach(function(e) {
                    for(var i=0;i< e.gaugeCount;i++) {
                        var id = e.name+'-gauge'+i;
                        d3.select('#'+ e.name).append('g').attr('id', id).attr('transform', function(d) {
                            return 'translate('+i*50+',90)';
                        });
                        var gauge = new d3.custom.gauge(d3.select('#'+id));
//                    gauge.id(id)
                        gauge.watch(PMQDemo.generator);
                    }
//                var gauge = new d3.custom.gauge(d3.select('#'+ e.name))
//                gauge.watch(PMQDemo.generator)
                })
                PMQDemo.generator.start();
            }

        })





    </script>
    </div>
